"use strict";(self.webpackChunk_typed_inject_website=self.webpackChunk_typed_inject_website||[]).push([[363],{9613:(e,t,r)=>{r.d(t,{Zo:()=>p,kt:()=>v});var n=r(9496);function s(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){s(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function a(e,t){if(null==e)return{};var r,n,s=function(e,t){if(null==e)return{};var r,n,s={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(s[r]=e[r]);return s}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(s[r]=e[r])}return s}var c=n.createContext({}),l=function(e){var t=n.useContext(c),r=t;return e&&(r="function"==typeof e?e(t):o(o({},t),e)),r},p=function(e){var t=l(e.components);return n.createElement(c.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var r=e.components,s=e.mdxType,i=e.originalType,c=e.parentName,p=a(e,["components","mdxType","originalType","parentName"]),u=l(r),m=s,v=u["".concat(c,".").concat(m)]||u[m]||d[m]||i;return r?n.createElement(v,o(o({ref:t},p),{},{components:r})):n.createElement(v,o({ref:t},p))}));function v(e,t){var r=arguments,s=t&&t.mdxType;if("string"==typeof e||s){var i=r.length,o=new Array(i);o[0]=m;var a={};for(var c in t)hasOwnProperty.call(t,c)&&(a[c]=t[c]);a.originalType=e,a[u]="string"==typeof e?e:s,o[1]=a;for(var l=2;l<i;l++)o[l]=r[l];return n.createElement.apply(null,o)}return n.createElement.apply(null,r)}m.displayName="MDXCreateElement"},1026:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>d,frontMatter:()=>i,metadata:()=>a,toc:()=>l});var n=r(1966),s=(r(9496),r(9613));const i={sidebar_position:5},o="Singletons",a={unversionedId:"guide/services/singletons",id:"guide/services/singletons",title:"Singletons",description:"Sometimes, you'll want a service to only be created once.",source:"@site/docs/guide/services/singletons.md",sourceDirName:"guide/services",slug:"/guide/services/singletons",permalink:"/docs/guide/services/singletons",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/guide/services/singletons.md",tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5},sidebar:"tutorialSidebar",previous:{title:"Resolution Constraints",permalink:"/docs/guide/services/resolution-constraints"},next:{title:"Transient Services",permalink:"/docs/guide/services/transient-services"}},c={},l=[],p={toc:l},u="wrapper";function d(e){let{components:t,...r}=e;return(0,s.kt)(u,(0,n.Z)({},p,r,{components:t,mdxType:"MDXLayout"}),(0,s.kt)("h1",{id:"singletons"},"Singletons"),(0,s.kt)("p",null,"Sometimes, you'll want a service to only be created once.\nThis might be when it has side-effects, such as creating a web server."),(0,s.kt)("p",null,"TypeDI supports this use-case by allowing individual services to be marked as singletons.\nWhen they are, only one instance of them will ",(0,s.kt)("em",{parentName:"p"},"ever")," be created over the lifetime of the application."),(0,s.kt)("admonition",{type:"tip"},(0,s.kt)("p",{parentName:"admonition"},"Singletons are attached to the globally-available default container.\nThis means that, regardless of the container which resolves them,\nthe same value will always be returned.")),(0,s.kt)("p",null,"Singletons are created very similarly to ordinary services, with one extra configuration parameter that must be declared."),(0,s.kt)("p",null,"As an example, let's create services for an application that hosts a web server.\nWe'd only want that web server to be created once, so we'd mark it as a singleton."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="src/webserver.service.ts"',title:'"src/webserver.service.ts"'},"import { Service } from '@freshgum/typedi';\nimport http from 'http'; // Node's HTTP module\n\n@Service(\n  {\n    // highlight-revision-start\n    singleton: true,\n    // highlight-revision-end\n  },\n  []\n)\nexport class WebServerService {\n  private server: http.Server;\n  startServer() {\n    this.server = http.createServer((request, response) => {\n      response.write('Hello world!');\n      response.end();\n    });\n\n    this.server.listen(3000);\n  }\n}\n")),(0,s.kt)("p",null,"Once we've done that, we can then start the web server in our root service."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="src/root.service.ts"',title:'"src/root.service.ts"'},"import { Service } from '@freshgum/typedi';\nimport { WebServerService } from './webserver.service';\n\n@Service([WebServerService])\nexport class RootService {\n  constructor(private webServer: WebServerService) {}\n\n  bootstrap() {\n    this.webServer.startServer();\n  }\n}\n")),(0,s.kt)("p",null,"Now, any services which use the web-server as a dependency, regardless of if they\nare child containers, will always refer to that same web server instance.\nThis prevents multiple web servers from being started at once."),(0,s.kt)("admonition",{type:"tip"},(0,s.kt)("p",{parentName:"admonition"},(0,s.kt)("strong",{parentName:"p"},"Utilising singletons for run-once operations is broadly considered a good idea.")),(0,s.kt)("p",{parentName:"admonition"},"In the case of our demo application, if multiple web server instances were to start,\nyou would experience runtime errors as only one server can be hosted on a port at a time."),(0,s.kt)("p",{parentName:"admonition"},"On the contrary, TypeDI also supports ",(0,s.kt)("a",{parentName:"p",href:"/docs/guide/services/multiple-services"},"creating ",(0,s.kt)("em",{parentName:"a"},"multiple")," instances of a service"),".")))}d.isMDXComponent=!0}}]);